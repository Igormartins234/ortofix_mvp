<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrtoFix - Detalhes da Turma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="../static/img/favicon.png">
    <script src="https://unpkg.com/lucide@latest"></script> <!-- Lucide Icons -->
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #4A90E2;
            --color-primary-dark: #357ABD;
            --color-accent: #50E3C2;
            --color-background: #F4F7FA;
            --color-text-dark: #2c3e50;
            --color-text-light: #8492a6;
            --color-card-bg: #ffffff;
            --color-border: #EAEFF5; /* Nova cor para bordas */
            --color-success: #28a745; /* Nova cor para status ativo */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-dark);
            /* Gradiente linear mais suave */
            background-image: linear-gradient(180deg, #FDFEFE 0%, var(--color-background) 100%);
        }
        
        .navbar-logo {
            width: 40px; 
            height: auto;
        }       

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background-color: #EF4444;
            border-radius: 50%;
            border: 2px solid var(--color-primary-dark);
        }
        
        /* Animações de entrada para os elementos da página */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* --- ESTILOS PARA OS CARDS DE ALUNO --- */
        .student-card {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            position: relative;
            overflow: hidden; /* Garante que a borda lateral não vaze */
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(44, 62, 80, 0.08), 0 4px 6px -2px rgba(44, 62, 80, 0.04);
        }

        /* Borda lateral colorida para indicar status */
        .student-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background-color: var(--color-border); /* Cor padrão para inativo */
            transition: background-color 0.3s ease;
        }

        .student-card.status-ativo::before {
            background-color: var(--color-success);
        }
        
        /* Badge de status aprimorado */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem; /* 8px */
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem; /* 12px */
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-ativo-badge {
            color: #166534; /* green-800 */
            background-color: #DCFCE7; /* green-100 */
        }
        .status-ativo-badge .status-dot {
            background-color: var(--color-success);
        }

        .status-inativo-badge {
            color: #7f1d1d; /* red-800 */
            background-color: #FEE2E2; /* red-100 */
        }
        .status-inativo-badge .status-dot {
            background-color: #dc2626; /* red-600 */
        }
        
        /* Skeleton card aprimorado */
        .skeleton-card {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            position: relative;
            overflow: hidden;
        }
        .skeleton-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background-color: var(--color-border);
        }
    </style>
</head>
<body class="bg-[#e3ebf2] min-h-screen flex flex-col">

<header class="header-nav sticky top-0 z-50">
    <nav class="bg-[#3c6a99] text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">
        <!-- Menu Principal -->
            <div class="relative">
                <button id="menu-btn" type="button" aria-label="Abrir menu principal" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-menu" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                    <i data-lucide="menu"></i>
                </button>
                <div id="dropdown-menu" class="absolute left-0 mt-3 bg-white rounded-lg shadow-xl py-2 w-56 hidden z-[60]" role="menu">
                    <!-- Itens do menu -->
                    <a href="painel.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100 transition-colors duration-200">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Painel Principal
                    </a>
                    <a href="#" role="menuitem" id="sound-btn" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100 transition-colors duration-200">
                        <i data-lucide="volume-2" class="w-5 h-5"></i> Som
                    </a>
                    <a href="notificacoes.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100 transition-colors duration-200">
                        <i data-lucide="bell-ring" class="w-5 h-5"></i> Ver Notificações
                    </a>
                    <a href="configuracoes.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100 transition-colors duration-200">
                        <i data-lucide="settings" class="w-5 h-5"></i> Configurações
                    </a>
                    <hr class="my-1 border-gray-200">
                    <a href="../index.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors duration-200">
                        <i data-lucide="log-out" class="w-5 h-5"></i> Sair
                    </a>
                </div>
            </div>

            <!-- Logo -->
            <a href="./index.html" class="mx-auto md:mx-0"> 
                <img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="navbar-logo">
            </a>

            <!-- Ícones da Direita: Notificações e Perfil -->
            <div class="flex items-center gap-2">
                <!-- Ícone de Notificações -->
                <div class="relative">
                    <button id="notifications-btn" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                        <i data-lucide="bell" class="text-white"></i>
                        <span class="notification-badge" id="notification-indicator"></span>
                    </button>
                    <!-- Dropdown de Notificações -->
                    <div id="notifications-dropdown" class="absolute right-0 mt-3 w-72 sm:w-80 bg-white rounded-lg shadow-xl hidden z-[60] overflow-hidden">
                        <div class="p-3 border-b border-gray-200">
                            <h3 class="text-sm font-semibold text-[#3c6a99]">Notificações Recentes</h3>
                        </div>
                        <div class="max-h-80 overflow-y-auto">
                            <a href="#" class="block px-4 py-3 hover:bg-[#e3ebf2] transition-colors">
                                <p class="text-sm text-[#3c6a99] font-medium">Aluno 'João Silva' completou uma atividade!</p>
                                <p class="text-xs text-gray-500">Jogo de Acentuação - Nível Médio</p>
                                <p class="text-xs text-gray-400 mt-1">Há 5 minutos</p>
                            </a>
                            <a href="#" class="block px-4 py-3 hover:bg-[#e3ebf2] transition-colors">
                                <p class="text-sm text-[#3c6a99] font-medium">Nova dúvida enviada.</p>
                                <p class="text-xs text-gray-500">Por 'Mariana Costa' sobre Crase.</p>
                                <p class="text-xs text-gray-400 mt-1">Há 30 minutos</p>
                            </a>
                        </div>
                        <a href="notificacoes.html" class="block py-2 text-center text-sm text-[#5689b9] hover:text-[#3c6a99] hover:bg-gray-100 border-t border-gray-200">
                            Ver todas as notificações
                        </a>
                    </div>
                </div>

                <!-- Ícone de Perfil -->
                <a href="perfil.html" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                    <i data-lucide="user-circle" class="text-white"></i>
                </a>
            </div>
        </div>
    </nav>
</header>

<!-- Conteúdo Principal Aprimorado -->
<main class="container mx-auto px-4 sm:px-6 py-8 flex-grow">
    <div class="mb-8 fade-in" style="animation-delay: 100ms;">
         <a href="gerenciador_alunos.html" class="inline-flex items-center text-sm font-medium text-[var(--color-text-light)] hover:text-[var(--color-primary)] transition-colors group">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2 transition-transform group-hover:-translate-x-1"></i>
                    Voltar
                </a>
    </div>
    
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4 fade-in" style="animation-delay: 200ms;">
        <h1 id="titulo-turma" class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight">Carregando...</h1>
        <span id="contador-alunos" class="bg-blue-100 text-blue-800 text-base font-semibold px-4 py-2 rounded-full hidden"></span>
    </div>
    
    <!-- Lista de alunos da turma específica -->
    <div id="lista-alunos-turma" class="space-y-4">
        <!-- Skeletons aprimorados que imitam o card final -->
        <div class="skeleton-card p-5 space-y-4 animate-pulse">
            <div class="flex justify-between items-center">
                <div class="h-6 bg-gray-200 rounded w-1/2"></div>
                <div class="h-6 bg-gray-200 rounded w-1/4"></div>
            </div>
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
            <div class="flex gap-6 pt-2">
                <div class="h-5 bg-gray-200 rounded w-1/4"></div>
                <div class="h-5 bg-gray-200 rounded w-1/4"></div>
            </div>
        </div>
        <div class="skeleton-card p-5 space-y-4 animate-pulse">
            <div class="flex justify-between items-center">
                <div class="h-6 bg-gray-200 rounded w-1/2"></div>
                <div class="h-6 bg-gray-200 rounded w-1/4"></div>
            </div>
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
            <div class="flex gap-6 pt-2">
                <div class="h-5 bg-gray-200 rounded w-1/4"></div>
                <div class="h-5 bg-gray-200 rounded w-1/4"></div>
            </div>
        </div>
    </div>
</main>

<footer class="bg-[#3c6a99] text-white border-t border-gray-200 mt-auto">
    <div class="container mx-auto py-4 px-4 text-center text-sm">
        <div class="flex items-center justify-center gap-2">
            <p class="opacity-80">&copy; 2025 OrtoFix</p>
            <img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="h-6" style="filter: brightness(0) invert(1);">
        </div>
    </div>
</footer>

<script>
    lucide.createIcons();

    // --- LÓGICA DO MENU DROPDOWN E NOTIFICAÇÕES ---
    const menuBtn = document.getElementById("menu-btn");
    const dropdownMenu = document.getElementById("dropdown-menu");
    const notificationsBtn = document.getElementById("notifications-btn");
    const notificationsDropdown = document.getElementById("notifications-dropdown");

    if (menuBtn && dropdownMenu) {
        menuBtn.addEventListener("click", () => {
            dropdownMenu.classList.toggle("hidden");
            if (notificationsDropdown && !notificationsDropdown.classList.contains("hidden")) {
                notificationsDropdown.classList.add("hidden");
            }
        });
    }

    if (notificationsBtn && notificationsDropdown) {
        notificationsBtn.addEventListener("click", () => {
            notificationsDropdown.classList.toggle("hidden");
            if (dropdownMenu && !dropdownMenu.classList.contains("hidden")) {
                dropdownMenu.classList.add("hidden");
            }
        });
    }
    
    document.addEventListener("click", (e) => {
        if (menuBtn && !menuBtn.contains(e.target) && dropdownMenu && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.add("hidden");
        }
        if (notificationsBtn && !notificationsBtn.contains(e.target) && notificationsDropdown && !notificationsDropdown.contains(e.target)) {
            notificationsDropdown.classList.add("hidden");
        }
    });

    const listaAlunosDiv = document.getElementById('lista-alunos-turma');
    const contadorAlunosSpan = document.getElementById('contador-alunos');
    const tituloTurmaH1 = document.getElementById('titulo-turma');

    // --- FUNÇÃO JAVASCRIPT ATUALIZADA ---
    async function carregarAlunosDaTurma() {
        const params = new URLSearchParams(window.location.search);
        const nomeTurma = params.get('turma');

        if (!nomeTurma) {
            tituloTurmaH1.textContent = "Turma não encontrada";
            listaAlunosDiv.innerHTML = '<div class="text-center py-10 bg-white rounded-lg shadow-sm"><p class="text-red-500">Por favor, volte e selecione uma turma válida.</p></div>';
            return;
        }
        
        tituloTurmaH1.textContent = `Turma: ${decodeURIComponent(nomeTurma)}`;
        const token = localStorage.getItem('authToken');
        if (!token) { 
            tituloTurmaH1.textContent = "Acesso Negado";
            listaAlunosDiv.innerHTML = '<div class="text-center py-10 bg-white rounded-lg shadow-sm"><p class="text-red-500">Você precisa estar logado para ver esta página.</p></div>';
            return; 
        }

        try {
            // Simulação de delay para que o efeito de loading seja visível
            await new Promise(resolve => setTimeout(resolve, 500)); 

            const response = await fetch('https://back-end-mvp-tcc.vercel.app/api/professor/alunos', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const turmas = await response.json();
            if (!response.ok) throw new Error(turmas.msg || 'Erro ao carregar dados.');

            const alunosDaTurma = turmas[decodeURIComponent(nomeTurma)];
            
            listaAlunosDiv.innerHTML = ''; // Limpa os skeletons

            if (!alunosDaTurma || alunosDaTurma.length === 0) {
                listaAlunosDiv.innerHTML = '<div class="text-center py-10 bg-white rounded-lg shadow-sm"><p class="text-gray-500">Nenhum aluno encontrado para esta turma.</p></div>';
                contadorAlunosSpan.textContent = `0 Alunos`;
                contadorAlunosSpan.classList.remove('hidden');
                return;
            }

            contadorAlunosSpan.textContent = `${alunosDaTurma.length} ${alunosDaTurma.length === 1 ? 'Aluno' : 'Alunos'}`;
            contadorAlunosSpan.classList.remove('hidden');

            // Renderiza os cards dos alunos com o novo design e animação
            alunosDaTurma.forEach((aluno, index) => {
                const isAtivo = aluno.status === 'ativo';
                const card = document.createElement('div');
                card.className = `student-card p-5 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 fade-in ${isAtivo ? 'status-ativo' : ''}`;
                card.style.animationDelay = `${index * 100}ms`; // Animação escalonada
                
                card.innerHTML = `
                    <div class="flex-grow">
                        <h3 class="text-xl font-semibold text-gray-800">${aluno.nomealuno}</h3>
                        <p class="text-sm text-gray-500">${aluno.emailaluno}</p>
                        <div class="flex items-center gap-6 mt-4 text-sm text-gray-600">
                            <span class="flex items-center gap-2"><i data-lucide="coins" class="w-5 h-5 text-yellow-500"></i> <strong class="text-base">${aluno.moedas || 0}</strong></span>
                            <span class="flex items-center gap-2"><i data-lucide="star" class="w-5 h-5 text-amber-500"></i> <strong class="text-base">${aluno.nivel || 'N/A'}</strong></span>
                        </div>
                    </div>
                    <div class="mt-3 sm:mt-0">
                        <span class="status-badge ${isAtivo ? 'status-ativo-badge' : 'status-inativo-badge'}">
                            <span class="status-dot"></span>
                            ${aluno.status}
                        </span>
                    </div>
                `;
                listaAlunosDiv.appendChild(card);
            });
            lucide.createIcons();

        } catch (error) {
            listaAlunosDiv.innerHTML = `<div class="text-center py-10 bg-red-50 rounded-lg"><p class="text-red-600"><strong>Erro:</strong> ${error.message}</p></div>`;
        }
    }
    document.addEventListener('DOMContentLoaded', carregarAlunosDaTurma);

    // --- Lógica da Navbar do Professor (se aplicável) ---
    // (Mantido para o caso de ser necessário no futuro)
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('authToken');
            window.location.href = 'login.html';
        });
    }
</script>
</body>
</html>