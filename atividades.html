    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>OrtoFix - Painel do Aluno</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="icon" type="image/png" href="./static/img/favicon.png">
        <script src="https://unpkg.com/lucide@latest"></script> <!-- Lucide Icons -->
        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
        <style>
            :root {
                --color-primary: #4A90E2;      /* Um azul mais vibrante e moderno */
                --color-primary-dark: #357ABD;
                --color-accent: #50E3C2;       /* Um verde-água como cor de destaque */
                --color-background: #F4F7FA;  /* Fundo mais claro e limpo */
                --color-text-dark: #2c3e50;   /* Um "quase preto" mais suave */
                --color-text-light: #8492a6;  /* Cinza para textos secundários */
                --color-card-bg: #ffffff;
                --color-navbar-bg: #3c6a99;
            }
.navbar-theme {
    background-color: var(--color-navbar-bg);
    transition: background-color 0.5s ease;
}
.inner-card-theme {
    /* No tema padrão, esta cor será um cinza muito claro */
    /* No tema escuro, será um cinza-azulado escuro, combinando perfeitamente */
    background-color: var(--color-border); 
    transition: background-color 0.5s ease;
}

.menu-theme {
    background-color: var(--color-card-bg);
    transition: background-color 0.5s ease;
}

/* Estilo para os itens normais do menu */
.menu-item-theme {
    color: var(--color-text-dark);
    transition: background-color 0.2s ease, color 0.2s ease;
}
.menu-item-theme:hover {
    background-color: var(--color-border);
}

/* Estilo para o item ATIVO do menu */
.menu-item-active {
    color: var(--color-primary);
    background-color: var(--color-border);
    font-weight: 600; /* semi-bold para destacar */
}
   
            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--color-background);
                color: var(--color-text-dark);
                transition: background-color 0.5s ease, color 0.5s ease;
            }
           
            .navbar-logo {
                width: 40px; 
                height: auto;
            }       
            .card-custom-icon {
                width: 48px; 
                height: 48px; 
                margin-bottom: 0.75rem; 
            }
            /* Estilo para o indicador de notificação (ponto vermelho) */
            .notification-badge {
                position: absolute;
                top: 0;
                right: 0;
                width: 12px;
                height: 12px;
                background-color: #EF4444;
                border-radius: 50%;
                border: 2px solid var(--color-primary-dark);
                animation: pulse 2s infinite cubic-bezier(0.66, 0, 0, 1);
            }
            @keyframes pulse {
                0%, 100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
                50% { transform: scale(1.1); box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
            }
            
            /* Animações de entrada para os elementos da página */
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            
            .fade-in {
                animation: fadeIn 0.6s ease-out forwards;
            }
        
        /* --- ESTILOS DE COMPONENTES CUSTOMIZADOS --- */
        .header-nav {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
        }

        .activity-card {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 1.25rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative; 
            overflow: hidden;
        }
        .activity-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.03);
        }
        .activity-card::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--color-accent), var(--color-primary));
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.4s ease-in-out;
    }

    .activity-card:hover::after {
        transform: scaleX(1);
    }
        </style>
    </head>
<body class="min-h-screen flex flex-col">

<div id="loading-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--color-background); display: flex; align-items: center; justify-content: center; z-index: 10001; transition: opacity 0.5s ease;">
    <div style="text-align: center;">
        <i data-lucide="loader-2" style="width: 3rem; height: 3rem; margin: 0 auto; animation: spin 1s linear infinite;"></i>
    </div>
</div>
<header class="header-nav sticky top-0 z-50">
    <nav class="navbar-theme text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">
        <!-- Menu Principal -->
            <div class="relative">
                <button id="menu-btn" type="button" aria-label="Abrir menu principal" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-menu" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                    <i data-lucide="menu"></i>
                </button>
                <div id="dropdown-menu" class="menu-theme absolute left-0 mt-3 rounded-lg shadow-xl py-2 w-56 hidden z-[60]" role="menu">
    <!-- Itens do menu -->
    <a href="inicio.html" role="menuitem" class="menu-item-active flex items-center gap-3 px-4 py-2">
        <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Painel Principal
    </a>
    <a href="#" role="menuitem" id="sound-btn" class="menu-item-theme flex items-center gap-3 px-4 py-2">
        <i data-lucide="volume-2" class="w-5 h-5"></i> Som
    </a>
    <a href="notificacoes.html" role="menuitem" class="menu-item-theme flex items-center gap-3 px-4 py-2">
        <i data-lucide="bell-ring" class="w-5 h-5"></i> Ver Notificações
    </a>
    <a href="configuracoes.html" role="menuitem" class="menu-item-theme flex items-center gap-3 px-4 py-2">
        <i data-lucide="settings" class="w-5 h-5"></i> Configurações
    </a>
    <hr class="my-1" style="border-color: var(--color-border);">
    <!-- O botão Sair mantém as cores vermelhas por padrão de UX -->
    <a href="./index.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors duration-200">
        <i data-lucide="log-out" class="w-5 h-5"></i> Sair
    </a>
</div>
            </div>

            <!-- Logo -->
            <a href="./index.html" class="mx-auto md:mx-0"> 
                <img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="navbar-logo">
            </a>

            <!-- Ícones da Direita: Notificações e Perfil -->
            <div class="flex items-center gap-2">
                <!-- Ícone de Notificações -->
                <div class="relative rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                    <button id="notifications-btn" class="p-2 focus:outline-none focus:bg-[#5689b9] rounded-md ">
                        <i data-lucide="bell" class="text-[#e3ebf2]"></i>
                    
                        <span class="notification-badge" id="notification-indicator"></span>
                    </button>
                    <!-- Dropdown de Notificações -->
                    <!-- CÓDIGO NOVO E CORRIGIDO PARA O DROPDOWN DE NOTIFICAÇÕES -->
<div id="notifications-dropdown" class="menu-theme absolute right-0 mt-2 w-72 sm:w-80 rounded-lg shadow-xl hidden z-[60] overflow-hidden">
    <!-- Cabeçalho do dropdown -->
    <div class="p-3 border-b" style="border-color: var(--color-border);">
        <h3 class="text-sm font-semibold" style="color: var(--color-text-dark);">Notificações Recentes</h3>
    </div>

    <!-- Lista de notificações -->
    <div class="max-h-80 overflow-y-auto">
        <!-- Exemplo 1 -->
        <a href="#" class="menu-item-theme block px-4 py-3">
            <p class="text-sm font-medium">Nova atividade disponível!</p>
            <p class="text-xs" style="color: var(--color-text-light);">Jogo de Acentuação - Nível Médio</p>
        </a>
        <!-- Exemplo 2 -->
        <a href="#" class="menu-item-theme block px-4 py-3">
            <p class="text-sm font-medium">Você ganhou 50 moedas!</p>
            <p class="text-xs" style="color: var(--color-text-light);">Por completar "Caça-Palavras Avançado".</p>
        </a>
        <!-- Exemplo 3 (Lida) -->
        <a href="#" class="menu-item-theme block px-4 py-3 opacity-70">
            <p class="text-sm font-medium">Feedback do Professor</p>
            <p class="text-xs" style="color: var(--color-text-light);">Na atividade "Ditado Interativo".</p>
        </a>
    </div>

    <!-- Link para ver todas -->
    <a href="notificacoes.html" class="menu-item-theme block py-2 text-center text-sm border-t" style="border-color: var(--color-border);">
        Ver todas as notificações
    </a>
</div>
                </div>

                <!-- Ícone de Perfil -->
<a href="perfil.html" id="user-avatar-container" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
    <!-- O script global-init.js vai inserir o avatar aqui -->
</a>
            </div>
        </div>
    </nav>
</header>

    <!-- Conteúdo Principal das Atividades -->
    <main class="container mx-auto px-6 py-12 flex-grow">
        <div class="max-w-5xl mx-auto">
          <div class="mb-12 fade-in">
    <h1 class="text-4xl md:text-5xl font-bold text-dynamic-dark mb-2">Atividades</h1>
    <p id="welcome-message" class="text-lg text-dynamic-light">Olá! Escolha um desafio para começar.</p>
</div>

            <p id="status" class="text-center text-sm text-dynamic-light mb-6"></p>

            <div id="activities-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Atividades serão inseridas aqui pelo JavaScript -->
            </div>
        </div>
    </main>

    <footer class="navbar-theme text-[#e3ebf2] border-t border-gray-200 mt-auto">
    <div class="container mx-auto py-2 px-4 text-center text-text-muted text-sm">
        <div class="flex items-center justify-center gap-2">
            <p>&copy; 2025 OrtoFix</p>
            <img src="../static/img/ortofix.png" alt="OrtoFix Logo" 
                class="h-6" style="filter: brightness(0) invert(1);">
        </div>
    </div>
</footer>

<script>
const API_BASE = 'https://back-end-mvp-tcc.vercel.app';

function clearAndGoLogin() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('userData');
    window.location.href = 'aluno.html';
}

function createActivityElement(activity) {
    const {
        id = '',
        titulo = 'Atividade',
        descricao = 'Descrição da atividade.',
        icon = 'puzzle',
        url = `atividade.html?id=${id}`,
        status = 'available'
    } = activity;

    const a = document.createElement('a');
    a.href = url;
    a.className = 'activity-card p-6 flex flex-col items-center text-center';
    a.dataset.activityId = id;

    if (status !== 'available') {
        a.classList.add('opacity-60', 'cursor-not-allowed');
        a.href = '#';
        a.onclick = (e) => e.preventDefault();
    }
    
    let statusBadgeHtml = '';
    if (status === 'coming_soon') {
        statusBadgeHtml = `<div class="absolute top-4 right-4 text-xs font-semibold px-2.5 py-1 bg-gray-200 text-gray-600 rounded-full">Em Breve</div>`;
    } else if (status === 'locked') {
            statusBadgeHtml = `<div class="absolute top-4 right-4 text-xs font-semibold px-2.5 py-1 bg-yellow-100 text-yellow-700 rounded-full flex items-center gap-1"><i data-lucide="lock" class="w-3 h-3"></i> Bloqueado</div>`;
    }

    a.innerHTML = `
        ${statusBadgeHtml}
        <div class="mb-4 p-4 bg-blue-100 rounded-full">
            <i data-lucide="${icon}" class="w-10 h-10 text-blue-500"></i>
        </div>
       <h3 class="text-xl font-semibold mb-1" style="color: var(--color-text-dark);">${titulo}</h3>
<p class="text-sm mb-4 flex-grow" style="color: var(--color-text-light);">${descricao}</p>
        <span class="font-semibold text-sm ${status === 'available' ? 'text-primary' : 'text-text-muted'}">
            ${status === 'available' ? 'Iniciar Atividade' : 'Indisponível'}
        </span> 
    `;
    return a;
}

function renderActivitiesList(activities) {
    const grid = document.getElementById('activities-grid');
    const statusEl = document.getElementById('status');
    grid.innerHTML = '';

    if (!Array.isArray(activities) || activities.length === 0) {
        statusEl.textContent = 'Nenhuma atividade disponível no momento. Usando atividades padrão.';
        const fallback = [
            { id: 'ortofix', titulo: 'OrtoFix Game', descricao: 'Identifique as palavras com erros ortográficos.', icon: 'puzzle', url: 'game.html', status: 'available' },
            // --- ALTERAÇÃO FEITA AQUI ---
            { id: 'typerun', titulo: 'Caça-Erros', descricao: 'Teste sua velocidade e precisão na digitação.', icon: 'file-text', url: 'typerun.html', status: 'available' },
            { id: 'texto', titulo: 'Exercícios de Texto', descricao: 'Complete, corrija e interprete textos.', icon: 'keyboard', url: 'atividade_correcao.html', status: 'available' },
        ];
        fallback.forEach(act => grid.appendChild(createActivityElement(act)));
    } else {
        activities.forEach(act => grid.appendChild(createActivityElement(act)));
    }
    lucide.createIcons();
}


async function loadPageData() {
    const token = localStorage.getItem('authToken');
    const statusEl = document.getElementById('status');

    if (!token) {
        clearAndGoLogin();
        return;
    }

    const welcomeMessage = document.getElementById('welcome-message');
    const userDataString = localStorage.getItem('userData');
    if (userDataString) {
        const userData = JSON.parse(userDataString);
        const firstName = userData.name.split(' ')[0];
        welcomeMessage.textContent = `Olá, ${firstName}! Escolha um desafio para começar.`;
    }

    try {
        statusEl.textContent = 'Carregando atividades...';
        const actsResp = await fetch(`${API_BASE}/api/aluno/atividades`, {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        if (!actsResp.ok) {
            if (actsResp.status === 401 || actsResp.status === 403) {
                clearAndGoLogin();
                return;
            }
            throw new Error(`Erro do servidor: ${actsResp.status}`);
        }

        const activities = await actsResp.json();
        renderActivitiesList(activities);
        statusEl.textContent = '';

    } catch (err) {
        console.error('Erro de rede ao carregar atividades:', err);
        statusEl.textContent = 'Problema de conexão. Mostrando opções padrão.';
        renderActivitiesList([]);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();

    const setupDropdown = (btnId, dropdownId) => {
        const btn = document.getElementById(btnId);
        const dropdown = document.getElementById(dropdownId);
        if (!btn || !dropdown) return;

        btn.addEventListener('click', (event) => {
            event.stopPropagation();
            document.querySelectorAll('[id$="-dropdown"]').forEach(el => {
                if (el.id !== dropdownId) el.classList.add('hidden');
            });
            dropdown.classList.toggle('hidden');
        });
    };
    
    setupDropdown('profile-btn', 'profile-dropdown');
    setupDropdown('notifications-btn', 'notifications-dropdown');

    const closeAllDropdowns = () => {
            document.querySelectorAll('[id$="-dropdown"]').forEach(el => el.classList.add('hidden'));
    };
    window.addEventListener('click', closeAllDropdowns);
    window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') closeAllDropdowns();
    });
    
    document.getElementById('logout-btn')?.addEventListener('click', (e) => {
        e.preventDefault();
        clearAndGoLogin();
    });

    loadPageData();
});
// 🔹 Script de notificações
const notificationsBtn = document.getElementById("notifications-btn");
const notificationsDropdown = document.getElementById("notifications-dropdown");
const notificationIndicator = document.getElementById("notification-indicator");

let hasUnreadNotifications = true;
if (notificationIndicator && !hasUnreadNotifications) {
    notificationIndicator.classList.add("hidden");
}

if (notificationsBtn && notificationsDropdown) {
    notificationsBtn.addEventListener("click", () => {
        notificationsDropdown.classList.toggle("hidden");
        if (dropdownMenu && !dropdownMenu.classList.contains("hidden")) {
            dropdownMenu.classList.add("hidden");
        }
    });
    document.addEventListener("click", (e) => {
        if (!notificationsBtn.contains(e.target) && !notificationsDropdown.contains(e.target)) {
            notificationsDropdown.classList.add("hidden");
        }
    });
}// 🔹 Corrigindo bug do ID errado ("drop  down-menu")
const menuBtn = document.getElementById("menu-btn");
const dropdownMenu = document.getElementById("dropdown-menu");
if (menuBtn && dropdownMenu) {
    menuBtn.addEventListener("click", () => {
        dropdownMenu.classList.toggle("hidden");
        if (notificationsDropdown && !notificationsDropdown.classList.contains("hidden")) {
            notificationsDropdown.classList.add("hidden");
        }
    })
    document.addEventListener("click", (e) => {
        if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.add("hidden");
        }
    });
}
</script>

<script src="global-init.js"></script>
</body>
</html>