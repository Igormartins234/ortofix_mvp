<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrtoFix - Minhas Notifica√ß√µes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="./static/img/favicon.png">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- PADR√ÉO VISUAL UNIFICADO --- */
        :root {
            --color-primary: #4A90E2;
            --color-primary-dark: #357ABD;
            --color-accent: #50E3C2;
            --color-background: #F4F7FA;
            --color-text-dark: #2c3e50;
            --color-text-light: #8492a6;
            --color-card-bg: #ffffff;
            --color-border: #E2E8F0;
            --color-navbar-bg: #3c6a99;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-dark);
        }

        .navbar-logo {
            width: 40px;
            height: auto;
        }

        /* --- ESTILOS DE COMPONENTES DE TEMA --- */
        .navbar-theme { background-color: var(--color-navbar-bg); }
        .menu-theme { background-color: var(--color-card-bg); border: 1px solid var(--color-border); }
        .menu-item-theme { color: var(--color-text-dark); transition: background-color 0.2s ease, color 0.2s ease; }
        .menu-item-theme:hover { background-color: var(--color-border); }
        .menu-item-active { color: var(--color-primary); background-color: var(--color-border); font-weight: 600; }

         .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background-color: #EF4444;
            border-radius: 50%;
            border: 2px solid var(--color-primary-dark);
            animation: pulse 2s infinite cubic-bezier(0.66, 0, 0, 1);
        }
        .notification-badge.hidden {
            transform: scale(0);
        }
        @keyframes pulse {
            0%, 100% { transform: scale(0.9); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }
        
        /* Anima√ß√µes de entrada para os elementos da p√°gina */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .unread-dot {
            min-width: 10px;
            height: 10px;
            background-color: var(--color-primary);
            border-radius: 50%;
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<!-- üîπ NAVBAR PADRONIZADA -->
<header class="header-nav sticky top-0 z-50">
    <nav class="navbar-theme text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">
        <!-- Menu Principal -->
            <div class="relative">
                <button id="menu-btn" type="button" aria-label="Abrir menu principal" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-menu" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                    <i data-lucide="menu"></i>
                </button>
                <div id="dropdown-menu" class="menu-theme absolute left-0 mt-3 rounded-lg shadow-xl py-2 w-56 hidden z-[60]" role="menu">
                    <!-- Itens do menu -->
                    <a href="inicio.html" role="menuitem" class="menu-item-theme flex items-center gap-3 px-4 py-2">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Painel Principal
                    </a>
                    <a href="#" role="menuitem" id="sound-btn" class="menu-item-theme flex items-center gap-3 px-4 py-2">
                        <i data-lucide="volume-2" class="w-5 h-5"></i> Som
                    </a>
                    <a href="notificacoes.html" role="menuitem" class="menu-item-active flex items-center gap-3 px-4 py-2">
                        <i data-lucide="bell-ring" class="w-5 h-5"></i> Ver Notifica√ß√µes
                    </a>
                    <a href="configuracoes.html" role="menuitem" class="menu-item-theme flex items-center gap-3 px-4 py-2">
                        <i data-lucide="settings" class="w-5 h-5"></i> Configura√ß√µes
                    </a>
                    <hr class="my-1" style="border-color: var(--color-border);">
                    <a href="./index.html" role="menuitem" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors duration-200">
                        <i data-lucide="log-out" class="w-5 h-5"></i> Sair
                    </a>
                </div>
            </div>

            <!-- Logo -->
            <a href="./index.html" class="mx-auto md:mx-0"> 
                <img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="navbar-logo">
            </a>

            <!-- √çcones da Direita: Notifica√ß√µes e Perfil -->
            <div class="flex items-center gap-2">
                <!-- √çcone de Notifica√ß√µes -->
                <div class="relative">
                    <button id="notifications-btn" class="p-2 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                        <i data-lucide="bell"></i>
                        <span class="notification-badge" id="notification-indicator"></span>
                    </button>
                    <!-- Dropdown de Notifica√ß√µes (CORRIGIDO) -->
                    <div id="notifications-dropdown" class="menu-theme absolute right-0 mt-2 w-72 sm:w-80 rounded-lg shadow-xl hidden z-[60] overflow-hidden">
                        <div class="p-3 border-b" style="border-color: var(--color-border);">
                            <h3 class="text-sm font-semibold" style="color: var(--color-text-dark);">Notifica√ß√µes Recentes</h3>
                        </div>
                        <!-- A lista do dropdown ser√° inserida aqui pelo JS -->
                        <div id="dropdown-notifications-list"></div>
                        <a href="notificacoes.html" class="menu-item-theme block py-2 text-center text-sm border-t" style="border-color: var(--color-border);">
                            Ver todas as notifica√ß√µes
                        </a>
                    </div>
                </div>
                <!-- √çcone de Perfil -->
                <a href="perfil.html" id="user-avatar-container" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200">
                     <!-- O script global-init.js vai inserir o avatar aqui -->
                </a>
            </div>
        </div>
    </nav>
</header>

    <!-- üîπ CONTE√öDO PRINCIPAL -->
    <main class="container mx-auto px-4 sm:px-6 py-10 flex-grow">
        <div class="max-w-4xl mx-auto">
            <!-- Cabe√ßalho da P√°gina -->
            <div class="mb-8 fade-in">
                 <a href="inicio.html" class="inline-flex items-center text-sm font-medium text-[var(--color-text-light)] hover:text-[var(--color-primary)] transition-colors group">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2 transition-transform group-hover:-translate-x-1"></i>
                    Voltar ao Painel
                </a>
                <h1 class="text-3xl md:text-4xl font-bold text-[var(--color-text-dark)] mt-2">Minhas Notifica√ß√µes</h1>
                <p class="text-base text-[var(--color-text-light)] mt-1">Veja aqui todas as suas atualiza√ß√µes e avisos.</p>
            </div>

            <!-- Card Principal -->
            <div class="bg-[var(--color-card-bg)] shadow-xl rounded-xl w-full fade-in" style="animation-delay: 100ms;">
                <div class="p-6 flex flex-col sm:flex-row justify-between items-center gap-4 border-b" style="border-color: var(--color-border);">
                    <h2 class="text-lg font-semibold text-[var(--color-text-dark)]">Todas as Notifica√ß√µes</h2>
                    <button id="marcar-todas-lidas-btn" class="bg-blue-50 text-[var(--color-primary)] hover:bg-blue-100 text-sm font-semibold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="check-check" class="w-4 h-4"></i> Marcar todas como lidas
                    </button>
                </div>

                <div id="lista-todas-notificacoes">
                    <!-- Mensagem de "Sem Notifica√ß√µes" -->
                    <div id="aviso-sem-notificacoes" class="text-center text-[var(--color-text-light)] py-16 hidden">
                        <i data-lucide="party-popper" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                        <h3 class="text-xl font-semibold text-[var(--color-text-dark)]">Tudo em dia!</h3>
                        <p>Voc√™ n√£o tem nenhuma notifica√ß√£o no momento.</p>
                    </div>
                    <!-- A lista principal de notifica√ß√µes ser√° injetada aqui pelo JS -->
                </div>
            </div>
        </div>
    </main>

    <!-- üîπ FOOTER PADRONIZADO -->
    <footer class="navbar-theme text-[#e3ebf2] mt-auto">
        <div class="container mx-auto py-2 px-4 text-center text-sm">
            <div class="flex items-center justify-center gap-2">
                <p>&copy; 2025 OrtoFix</p>
                <img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="h-6" style="filter: brightness(0) invert(1);">
            </div>
        </div>
    </footer>

    <!-- üîπ SCRIPTS -->
    <audio id="click-sound" src="/static/audio/click.wav" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- L√ìGICA DOS MENUS DROPDOWN ---
            const menuBtn = document.getElementById("menu-btn");
            const dropdownMenu = document.getElementById("dropdown-menu");
            const notificationsBtn = document.getElementById("notifications-btn");
            const notificationsDropdown = document.getElementById("notifications-dropdown");

            const setupDropdown = (btn, menu) => {
                btn.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const isHidden = menu.classList.contains("hidden");
                    // Esconde todos os outros menus antes de mostrar o atual
                    document.querySelectorAll('.absolute.z-\\[60\\]').forEach(m => {
                        if (m !== menu) m.classList.add('hidden');
                    });
                    menu.classList.toggle("hidden");
                });
            };
            
            setupDropdown(menuBtn, dropdownMenu);
            setupDropdown(notificationsBtn, notificationsDropdown);

            // Fecha os menus se clicar fora
            document.addEventListener("click", () => {
                document.querySelectorAll('.absolute.z-\\[60\\]').forEach(m => m.classList.add('hidden'));
            });

            // --- L√ìGICA DO SOM ---
            const clickSound = document.getElementById("click-sound");
            let soundEnabled = true;
            const soundBtn = document.getElementById("sound-btn");

            if (soundBtn) {
                soundBtn.addEventListener("click", (e) => {
                    e.preventDefault();
                    soundEnabled = !soundEnabled;
                    const icon = soundBtn.querySelector("i");
                    icon.setAttribute("data-lucide", soundEnabled ? "volume-2" : "volume-x");
                    icon.classList.toggle("text-red-500", !soundEnabled);
                    lucide.createIcons();
                });
            }
            document.querySelectorAll("a, button").forEach(el => {
                el.addEventListener("click", () => {
                    if (soundEnabled && clickSound) {
                        clickSound.currentTime = 0;
                        clickSound.play().catch(() => {});
                    }
                });
            });

            // --- L√ìGICA DAS NOTIFICA√á√ïES ---

            // 1. DADOS (Simula√ß√£o de uma API)
            let notifications = [
                { id: 1, type: 'activity', title: 'Nova atividade dispon√≠vel!', description: 'Jogo de Acentua√ß√£o - N√≠vel M√©dio', time: 'H√° 15 minutos', read: false, icon: 'gamepad-2' },
                { id: 2, type: 'reward', title: 'Voc√™ ganhou 50 moedas!', description: 'Por completar "Ca√ßa-Palavras Avan√ßado".', time: 'H√° 1 hora', read: false, icon: 'coins' },
                { id: 3, type: 'feedback', title: 'Feedback do Professor', description: 'Na atividade "Ditado Interativo".', time: 'Ontem', read: true, icon: 'message-square-quote' },
                { id: 4, type: 'system', title: 'Manuten√ß√£o agendada', description: 'O sistema ficar√° offline no domingo.', time: '2 dias atr√°s', read: true, icon: 'server-cog' },
                { id: 5, type: 'activity', title: 'Desafio semanal lan√ßado!', description: 'Complete 5 atividades para ganhar um b√¥nus.', time: '3 dias atr√°s', read: false, icon: 'swords' }
            ];

            // 2. ELEMENTOS DO DOM
            const notificationIndicator = document.getElementById('notification-indicator');
            const dropdownList = document.getElementById('dropdown-notifications-list');
            const mainList = document.getElementById('lista-todas-notificacoes');
            const markAllReadBtn = document.getElementById('marcar-todas-lidas-btn');
            const noNotificationsMessage = document.getElementById('aviso-sem-notificacoes');

            // 3. FUN√á√ÉO PARA CRIAR O HTML DE UMA NOTIFICA√á√ÉO
            const createNotificationHTML = (notification, isForDropdown = false) => {
                const isUnread = !notification.read;
                const baseClasses = "flex items-start gap-4 p-4 transition-colors duration-200 cursor-pointer";
                const borderClass = isForDropdown ? 'border-b' : 'border-t first:border-t-0';
                const bgColor = isUnread ? 'bg-blue-50 hover:bg-blue-100' : 'bg-white hover:bg-gray-50';
                const iconColorClasses = {
                    activity: 'text-purple-500 bg-purple-100',
                    reward: 'text-amber-500 bg-amber-100',
                    feedback: 'text-green-500 bg-green-100',
                    system: 'text-slate-500 bg-slate-100'
                };
                const iconColor = iconColorClasses[notification.type] || 'text-gray-500 bg-gray-100';

                return `
                    <div class="notification-item ${baseClasses} ${bgColor} ${borderClass}" style="border-color: var(--color-border);" data-id="${notification.id}">
                        <div class="w-10 h-10 flex-shrink-0 rounded-full flex items-center justify-center ${iconColor}">
                            <i data-lucide="${notification.icon}" class="w-5 h-5"></i>
                        </div>
                        <div class="flex-grow">
                            <p class="text-sm font-semibold text-[var(--color-text-dark)]">${notification.title}</p>
                            <p class="text-xs text-[var(--color-text-light)]">${notification.description}</p>
                            <p class="text-xs text-gray-400 mt-1">${notification.time}</p>
                        </div>
                        ${isUnread ? '<div class="unread-dot self-center mr-2"></div>' : ''}
                    </div>
                `;
            };
            
            const createDropdownNotificationHTML = (notification) => {
                 const isUnread = !notification.read;
                 const baseClasses = "flex items-start gap-3 p-3 transition-colors duration-200 cursor-pointer";
                 const bgColor = 'hover:bg-gray-50'; // Simplificado para o dropdown

                 return `
                    <a href="#" class="notification-item block ${baseClasses} ${bgColor}" data-id="${notification.id}">
                         <div class="flex-grow">
                             <p class="text-sm font-medium text-[var(--color-text-dark)]">${isUnread ? '<span class="text-[var(--color-primary)]">‚óè</span>' : ''} ${notification.title}</p>
                             <p class="text-xs text-[var(--color-text-light)] truncate">${notification.description}</p>
                         </div>
                    </a>
                 `;
            }

            // 4. FUN√á√ÉO PRINCIPAL PARA RENDERIZAR TUDO
            const renderNotifications = () => {
                const unreadCount = notifications.filter(n => !n.read).length;

                notificationIndicator.classList.toggle('hidden', unreadCount === 0);
                markAllReadBtn.disabled = unreadCount === 0;

                if (notifications.length === 0) {
                    mainList.innerHTML = '';
                    noNotificationsMessage.classList.remove('hidden');
                    dropdownList.innerHTML = `<p class="text-center text-sm text-[var(--color-text-light)] p-4">Nenhuma notifica√ß√£o</p>`;
                } else {
                    noNotificationsMessage.classList.add('hidden');
                    // Renderiza a lista principal (p√°gina) e a do dropdown (navbar)
                    mainList.innerHTML = notifications.map(n => createNotificationHTML(n, false)).join('');
                    dropdownList.innerHTML = notifications.slice(0, 3).map(createDropdownNotificationHTML).join('');
                }
                
                lucide.createIcons();
            };
            
            // 5. FUN√á√ïES DE INTERA√á√ÉO
            const markAsRead = (id) => {
                const notification = notifications.find(n => n.id === id);
                if (notification && !notification.read) {
                    notification.read = true;
                    renderNotifications();
                }
            };
            
            const markAllAsRead = () => {
                notifications.forEach(n => n.read = true);
                renderNotifications();
            };

            // 6. EVENT LISTENERS
            markAllReadBtn.addEventListener('click', markAllAsRead);

            // Listener √∫nico para capturar cliques em qualquer notifica√ß√£o (principal ou dropdown)
            document.body.addEventListener('click', (e) => {
                const item = e.target.closest('.notification-item');
                if (item) {
                    e.preventDefault();
                    const id = parseInt(item.dataset.id, 10);
                    markAsRead(id);
                }
            });

            // 7. INICIALIZA√á√ÉO
            renderNotifications();
        });
    </script>
    
    <script src="global-init.js"></script>

</body>
</html>