<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OrtoFix - Desafio de Acentua√ß√£o</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    :root {
    --color-primary: #4A90E2;
    --color-primary-dark: #357ABD;
    --color-accent: #50E3C2;
    --color-background: #F4F7FA;
    --color-text-dark: #2c3e50;
    --color-text-light: #8492a6;
    --color-card-bg: #ffffff;
    }
    body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--color-background);
    color: var(--color-text-dark);
    background-image: radial-gradient(circle at top, #ffffff 0%, var(--color-background) 80%);
    }
    .navbar-logo { width: 40px; height: auto; }
    .notification-badge {
    position: absolute; top: 0; right: 0;
    width: 12px; height: 12px; background-color: #EF4444;
    border-radius: 50%; border: 2px solid var(--color-primary-dark);
    animation: pulse 2s infinite cubic-bezier(0.66, 0, 0, 1);
    }
    @keyframes pulse {
    0%,100%{transform:scale(.9);box-shadow:0 0 0 0 rgba(239,68,68,.7);}
    50%{transform:scale(1.1);box-shadow:0 0 0 8px rgba(239,68,68,0);}
    }
    @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
    }
    .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
code
Code
#mascote-assistente {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 100;
    transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
    transform: translateY(200%);
    opacity: 0;
}
#mascote-assistente.visible { transform: translateY(0); opacity: 1; }
#mascote-assistente .mascote-img {
    height: 100px;
    width: auto;
    animation: bobbing 3s ease-in-out infinite;
}
#chat-bubble {
    position: absolute;
    bottom: 84px;
    right: 47px;
    background-color: white;
    padding: 12px 16px;
    border-radius: 12px;
    width: 210px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    font-size: 14px;
    font-weight: 500;
    color: #3c6a99;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease, transform 0.3s ease;
}
#chat-bubble.show { opacity: 1; transform: scale(1); }
#chat-bubble::after {
    content: ''; position: absolute; bottom: -8px; right: 20px;
    width: 0; height: 0; border-left: 10px solid transparent;
    border-right: 10px solid transparent; border-top: 10px solid white;
}
@keyframes bobbing {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}
/* Estilo para feedback imediato na palavra */
#singleWordContainer.correct { border-color: #22c55e; }
#singleWordContainer.incorrect { border-color: #ef4444; }
</style>
</head>
<body class="bg-[#e3ebf2] min-h-screen flex flex-col">
<!-- üîπ NAVBAR -->
<header class="header-nav sticky top-0 z-50">
<nav class="bg-[#3c6a99] text-white shadow-lg">
    <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">
    <div class="relative">
        <button id="menu-btn" type="button" class="p-2 rounded-full hover:bg-white/10"><i data-lucide="menu"></i></button>
        <div id="dropdown-menu" class="absolute left-0 mt-3 bg-white rounded-lg shadow-xl py-2 w-56 hidden z-[60]">
        <a href="inicio.html" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100"><i data-lucide="layout-dashboard" class="w-5 h-5"></i> Painel Principal</a>
        <a href="#" id="sound-btn" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100"><i data-lucide="volume-2" class="w-5 h-5"></i> Som</a>
        <a href="notificacoes.html" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100"><i data-lucide="bell-ring" class="w-5 h-5"></i> Notifica√ß√µes</a>
        <a href="configuracoes.html" class="flex items-center gap-3 px-4 py-2 text-[var(--color-text-dark)] hover:bg-gray-100"><i data-lucide="settings" class="w-5 h-5"></i> Configura√ß√µes</a>
        <hr class="my-1 border-gray-200">
        <a href="../index.html" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50"><i data-lucide="log-out" class="w-5 h-5"></i> Sair</a>
        </div>
    </div>
    <a href="inicio.html"><img src="../static/img/ortofix.png" alt="OrtoFix Logo" class="navbar-logo"></a>
    <div class="flex items-center gap-2">
        <div class="relative">
            <button id="notifications-btn" class="p-2 rounded-full hover:bg-white/10"><i data-lucide="bell" class="text-[#e3ebf2]"></i><span class="notification-badge" id="notification-indicator"></span></button>
            <div id="notifications-dropdown" class="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl hidden z-[60]">
                <div class="p-3 border-b"><h3 class="text-sm font-semibold text-[#3c6a99]">Notifica√ß√µes</h3></div>
                <div class="max-h-80 overflow-y-auto"><a href="#" class="block px-4 py-3 hover:bg-[#e3ebf2] text-gray-600 text-sm">Nenhuma notifica√ß√£o nova</a></div>
            </div>
        </div>
        <a href="perfil.html" class="p-2 rounded-full hover:bg-white/10"><i data-lucide="user-circle" class="text-[#e3ebf2]"></i></a>
    </div>
    </div>
</nav>
</header>
<!-- üîπ CONTE√öDO PRINCIPAL -->
<main class="container mx-auto px-4 py-8 sm:py-12 flex-grow">
    <!-- Bot√£o Voltar -->
    <div class="mb-6">
        <a href="inicio.html" class="inline-flex items-center gap-2 text-[var(--color-text-light)] hover:text-[var(--color-text-dark)] transition-colors duration-200">
            <i data-lucide="chevron-left" class="w-5 h-5"></i><span class="font-semibold">Voltar ao Painel</span>
        </a>
    </div>
    <!-- Cabe√ßalho -->
    <div class="text-center mb-8 fade-in-up">
        <h1 class="text-4xl md:text-5xl font-bold text-[var(--color-text-dark)] mb-2 tracking-tight">Desafio de Acentua√ß√£o</h1>
        <p class="text-lg text-[var(--color-text-light)] max-w-2xl mx-auto">Responda o m√°ximo que puder antes que o tempo ou suas vidas acabem!</p>
    </div>
code
Code
<!-- PAINEL DE STATUS DO JOGO -->
<div id="gameStatus" class="max-w-4xl mx-auto mb-6 hidden">
    <div class="grid grid-cols-3 gap-4 text-center">
        <div class="bg-white/70 backdrop-blur-sm p-4 rounded-xl shadow-md">
            <p class="text-sm font-semibold text-gray-500">PONTUA√á√ÉO</p>
            <p id="scoreDisplay" class="text-2xl font-bold text-[var(--color-primary)]">0</p>
        </div>
        <div class="bg-white/70 backdrop-blur-sm p-4 rounded-xl shadow-md">
            <p class="text-sm font-semibold text-gray-500">TEMPO</p>
            <p id="timerDisplay" class="text-2xl font-bold text-slate-700">00:00</p>
        </div>
        <div class="bg-white/70 backdrop-blur-sm p-4 rounded-xl shadow-md">
            <p class="text-sm font-semibold text-gray-500">VIDAS</p>
            <div id="livesDisplay" class="flex justify-center items-center gap-2 text-2xl"></div>
        </div>
    </div>
</div>

<!-- √ÅREA DO JOGO (MODO PALAVRA √öNICA) -->
<div id="gameArea" class="max-w-lg mx-auto hidden">
    <form id="wordForm">
        <div id="singleWordContainer" class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg p-6 sm:p-8 border-4 border-transparent transition-all duration-300">
            <!-- A palavra e as op√ß√µes ser√£o injetadas aqui -->
        </div>
    </form>
</div>

<!-- √ÅREA DE FEEDBACK FINAL -->
<div id="feedbackArea" class="max-w-2xl mx-auto hidden">
    <div id="feedbackSummary" class="text-center bg-white p-8 rounded-xl shadow-2xl">
        <!-- O resumo final ser√° inserido aqui -->
    </div>
    <div class="text-center mt-8">
        <button id="btnJogarNovamente" class="flex items-center justify-center gap-2 mx-auto bg-[var(--color-primary)] hover:bg-[var(--color-primary-dark)] text-white px-8 py-3 rounded-lg shadow-lg transition-transform transform hover:scale-105">
            <i data-lucide="refresh-cw" class="w-5 h-5"></i><span class="font-semibold">Jogar Novamente</span>
        </button>
    </div>
</div>

<!-- TELA INICIAL (SELE√á√ÉO DE DIFICULDADE) -->
<div id="startArea" class="text-center mt-8 fade-in-up">
    <h2 class="text-2xl font-bold text-[var(--color-text-dark)] mb-4">Escolha o N√≠vel de Dificuldade</h2>
    <div class="flex flex-col sm:flex-row justify-center gap-4">
        <button data-difficulty="facil" class="difficulty-btn bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl shadow-lg transition-transform transform hover:scale-105"><span class="text-xl font-bold">F√°cil</span></button>
        <button data-difficulty="medio" class="difficulty-btn bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-xl shadow-lg transition-transform transform hover:scale-105"><span class="text-xl font-bold">M√©dio</span></button>
        <button data-difficulty="dificil" class="difficulty-btn bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-xl shadow-lg transition-transform transform hover:scale-105"><span class="text-xl font-bold">Dif√≠cil</span></button>
    </div>
</div>
</main>
<!-- üîπ Mascote Flutuante -->
<div id="mascote-assistente">
    <div id="chat-bubble">Vamos come√ßar o desafio?</div>
    <img src="../static/img/ortofix.png" alt="Assistente OrtoFix" class="mascote-img">
</div>
<!-- üîπ Rodap√© -->
<footer class="bg-[#3c6a99] text-[#e3ebf2] border-t border-gray-200 mt-auto">
    <div class="container mx-auto py-2 px-4 text-center text-sm"><p>&copy; 2025 OrtoFix</p></div>
</footer>
<!-- üîπ SONS -->
<audio id="click-sound" src="/static/audio/click.wav" preload="auto"></audio>
<audio id="correct-sound" src="/static/audio/correct.wav" preload="auto"></audio>
<audio id="wrong-sound" src="/static/audio/wrong.wav" preload="auto"></audio>
<!-- üîπ SCRIPT UNIFICADO -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    lucide.createIcons();

    // --- L√ìGICA DE MENUS E SOM --- (Minimizada para clareza)
    const setupDropdown = (btn, menu) => {
        btn.addEventListener("click", (e) => { e.stopPropagation(); document.querySelectorAll('.absolute.z-\\[60\\]').forEach(m => m.classList.add('hidden')); menu.classList.remove("hidden"); });
    };
    setupDropdown(document.getElementById("menu-btn"), document.getElementById("dropdown-menu"));
    setupDropdown(document.getElementById("notifications-btn"), document.getElementById("notifications-dropdown"));
    document.addEventListener("click", () => document.querySelectorAll('.absolute.z-\\[60\\]').forEach(m => m.classList.add('hidden')));

    let soundEnabled = true;
    const soundBtn = document.getElementById("sound-btn");
    if(soundBtn) soundBtn.addEventListener("click", (e) => { e.preventDefault(); soundEnabled = !soundEnabled; soundBtn.querySelector("i").setAttribute("data-lucide", soundEnabled ? "volume-2" : "volume-x"); lucide.createIcons(); });
    function playSound(soundId) {
        if (soundEnabled) {
            const sound = document.getElementById(soundId);
            if(sound) { sound.currentTime = 0; sound.play().catch(()=>{}); }
        }
    }
    document.querySelectorAll('a, button').forEach(el => el.addEventListener("click", () => playSound('click-sound')));

    // --- L√ìGICA DO JOGO ---
    const API_URL = "https://api-tcc-alpha.vercel.app";
    const DIFFICULTY_SETTINGS = {
        facil: { time: 130 },
        medio: { time: 90 },
        dificil: { time: 60 }
    };
    const MAX_MISTAKES = 2;

    // Elementos da UI
    const startArea = document.getElementById('startArea');
    const gameArea = document.getElementById('gameArea');
    const gameStatus = document.getElementById('gameStatus');
    const feedbackArea = document.getElementById('feedbackArea');
    const singleWordContainer = document.getElementById('singleWordContainer');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const timerDisplay = document.getElementById('timerDisplay');
    const livesDisplay = document.getElementById('livesDisplay');
    const feedbackSummary = document.getElementById('feedbackSummary');
    
    // Estado do Jogo
    let currentDifficulty, score, mistakes, timeRemaining, timerInterval, isGameActive, currentWord, totalCorrect;

    // --- Fun√ß√µes de Controle do Jogo ---
    function startGame(difficulty) {
        currentDifficulty = difficulty;
        score = 0;
        mistakes = 0;
        totalCorrect = 0;
        isGameActive = true;
        timeRemaining = DIFFICULTY_SETTINGS[difficulty].time;

        startArea.classList.add('hidden');
        feedbackArea.classList.add('hidden');
        gameArea.classList.remove('hidden');
        gameStatus.classList.remove('hidden');

        updateScore(0);
        updateLives();
        startTimer();
        fetchNextWord();
        changeBubbleText("O jogo come√ßou! Boa sorte!");
    }

    function endGame(reason) {
        if (!isGameActive) return;
        isGameActive = false;
        clearInterval(timerInterval);

        gameArea.classList.add('hidden');
        gameStatus.classList.add('hidden');
        feedbackArea.classList.remove('hidden');

        let message = "";
        if (reason === "mistakes") {
            message = "Voc√™ cometeu 2 erros.";
            playSound('wrong-sound');
        } else if (reason === "time") {
            message = "O tempo acabou!";
        }

        feedbackSummary.innerHTML = `
            <h2 class="text-3xl font-bold text-[var(--color-text-dark)]">Fim de Jogo!</h2>
            <p class="text-lg text-gray-600 mt-2">${message}</p>
            <div class="mt-6 grid grid-cols-2 gap-4 text-left">
                <div class="bg-blue-100 p-4 rounded-lg col-span-2">
                    <span class="block text-sm text-blue-500">Pontua√ß√£o Final</span>
                    <span class="font-bold text-3xl text-blue-700">${score}</span>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                    <span class="block text-sm text-slate-500">Palavras Corretas</span>
                    <span class="font-bold text-xl text-green-600">${totalCorrect}</span>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                    <span class="block text-sm text-slate-500">Dificuldade</span>
                    <span class="font-bold text-xl capitalize">${currentDifficulty}</span>
                </div>
            </div>`;
        
        showMascote();
        if(score > 500) {
            changeBubbleText("Uau! Que pontua√ß√£o incr√≠vel! Voc√™ √© um mestre!");
            launchConfetti();
        } else {
            changeBubbleText("Bom jogo! Continue praticando para melhorar ainda mais.");
        }
    }

    // --- Fun√ß√µes de Atualiza√ß√£o da UI ---
    function updateScore(points) {
        score += points;
        scoreDisplay.textContent = score;
    }

    function updateLives() {
        livesDisplay.innerHTML = '';
        for (let i = 0; i < MAX_MISTAKES - mistakes; i++) {
            livesDisplay.innerHTML += '<i data-lucide="heart" class="text-red-500 fill-current"></i>';
        }
        for (let i = 0; i < mistakes; i++) {
            livesDisplay.innerHTML += '<i data-lucide="heart" class="text-gray-300"></i>';
        }
        lucide.createIcons();
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeRemaining--;
            const minutes = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
            const seconds = (timeRemaining % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
            timerDisplay.classList.toggle('text-red-500', timeRemaining <= 10);
            if (timeRemaining <= 0) endGame("time");
        }, 1000);
    }
    
    // --- Fun√ß√µes de L√≥gica de Palavras ---
    async function fetchNextWord() {
        if (!isGameActive) return;
        singleWordContainer.innerHTML = `<p class="text-center text-gray-500">Carregando nova palavra...</p>`;
        try {
            const res = await fetch(`${API_URL}/api/ortofix/gerar_palavras`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ quantidade: 1, dificuldade: currentDifficulty })
            });
            if (!res.ok) throw new Error('API falhou');
            const data = await res.json();
            currentWord = data.palavras[0];
            renderSingleWord(currentWord);
        } catch (error) {
            singleWordContainer.innerHTML = `<p class="text-center text-red-500">Erro ao carregar palavra. Tente novamente.</p>`;
        }
    }

    function renderSingleWord(palavra) {
        singleWordContainer.classList.remove('correct', 'incorrect');
        singleWordContainer.innerHTML = `
            <p class="text-center text-3xl md:text-4xl font-bold text-[var(--color-text-dark)] mb-6">${palavra}</p>
            <select name="acento" id="acentoSelect" required class="w-full border-gray-300 rounded-lg shadow-sm text-lg p-3">
                <option value="" disabled selected>Escolha o acento...</option>
                <option value="agudo">Agudo (¬¥)</option>
                <option value="circunflexo">Circunflexo (^)</option>
                <option value="til">Til (~)</option>
                <option value="sem acento">Sem acento</option>
            </select>
            <button type="submit" class="mt-6 w-full flex items-center justify-center gap-2 bg-[var(--color-primary)] hover:bg-[var(--color-primary-dark)] text-white px-6 py-3 rounded-lg font-semibold shadow-md">
                <i data-lucide="check"></i> Verificar
            </button>
            <div id="feedback-explanation" class="mt-4 text-center"></div>`;
        lucide.createIcons();
    }

    async function checkAnswer(e) {
        e.preventDefault();
        if (!isGameActive) return;

        const select = document.getElementById('acentoSelect');
        const submitButton = e.target.querySelector('button[type="submit"]');
        select.disabled = true;
        submitButton.disabled = true;

        const respostaUsuario = select.value;
        try {
            const res = await fetch(`${API_URL}/api/ortofix/verificar`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ respostas: [{ palavra: currentWord, resposta_usuario: respostaUsuario }] })
            });
            const data = await res.json();
            const feedback = data.feedback; // O feedback vem como uma string longa
            
            const explanationDiv = document.getElementById('feedback-explanation');
            
            if (feedback.includes('- Resultado: Correto')) {
                playSound('correct-sound');
                singleWordContainer.classList.add('correct');
                updateScore(100 + (timeRemaining > 30 ? 10 : 0)); // B√¥nus por rapidez
                totalCorrect++;
                setTimeout(fetchNextWord, 1200);
            } else {
                playSound('wrong-sound');
                mistakes++;
                singleWordContainer.classList.add('incorrect');
                const explanationMatch = feedback.match(/- Explica√ß√£o: (.*)/);
                if (explanationMatch) {
                    explanationDiv.innerHTML = `<p class="text-red-600 font-semibold">${explanationMatch[1]}</p>`;
                }
                updateLives();
                if (mistakes >= MAX_MISTAKES) {
                    setTimeout(() => endGame("mistakes"), 2500);
                } else {
                    setTimeout(fetchNextWord, 2500);
                }
            }
        } catch (error) {
            select.disabled = false;
            submitButton.disabled = false;
        }
    }

    // --- Event Listeners Iniciais ---
    document.querySelectorAll('.difficulty-btn').forEach(button => {
        button.addEventListener('click', () => startGame(button.dataset.difficulty));
    });
    document.getElementById('wordForm').addEventListener('submit', checkAnswer);
    document.getElementById('btnJogarNovamente').addEventListener('click', () => {
        feedbackArea.classList.add('hidden');
        startArea.classList.remove('hidden');
        changeBubbleText("Pronto para mais um desafio? Escolha a dificuldade!");
        changeMascoteImage("/static/img/ortofix.png");
    });
    
    // --- L√ìGICA DO MASCOTE ---
    const mascoteAssistente = document.getElementById('mascote-assistente');
    const chatBubble = document.getElementById('chat-bubble');
    const showMascote = () => mascoteAssistente.classList.add('visible');
    const hideMascote = () => mascoteAssistente.classList.remove('visible');
    const changeBubbleText = (text) => {
        chatBubble.classList.remove('show');
        setTimeout(() => { chatBubble.textContent = text; chatBubble.classList.add('show'); }, 300);
    };
    const changeMascoteImage = (src) => {
        const img = document.querySelector('#mascote-assistente .mascote-img');
        if (img) img.src = src;
    };
    setTimeout(() => { showMascote(); changeBubbleText("Pronto para o desafio? Escolha uma dificuldade para come√ßar!"); }, 1500);
    function launchConfetti() { confetti({ particleCount: 150, spread: 500, origin: { y: 0.6 } }); }
});
</script>
</body>
</html>